<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="License" href="license.html" /><link rel="prev" title="Alzheimer’s Disease diagnosis from T1-weighted MRI" href="adni.html" />

    <!-- Generated with Sphinx 7.0.1 and Furo 2023.05.20 -->
        <title>Live cell image compression and classification - ARMED documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">ARMED  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">ARMED  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="_autosummary/armed.html">armed</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of armed</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/armed.callbacks.html">armed.callbacks</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of armed.callbacks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.callbacks.aec_callbacks.html">armed.callbacks.aec_callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.callbacks.segmentation.html">armed.callbacks.segmentation</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/armed.crossvalidation.html">armed.crossvalidation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of armed.crossvalidation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.crossvalidation.grouped_cv.html">armed.crossvalidation.grouped_cv</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.crossvalidation.splitting.html">armed.crossvalidation.splitting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/armed.metrics.html">armed.metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/armed.misc.html">armed.misc</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/armed.models.html">armed.models</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of armed.models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.autoencoder_classifier.html">armed.models.autoencoder_classifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.cnn_classifier.html">armed.models.cnn_classifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.lme.html">armed.models.lme</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.metalearning.html">armed.models.metalearning</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.mlp_classifiers.html">armed.models.mlp_classifiers</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.random_effects.html">armed.models.random_effects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/armed.settings.html">armed.settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/armed.tfutils.html">armed.tfutils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="applications.html">Applications</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Applications</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="synthetic_dataset.html">Synthetic datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="mci_conversion.html">Classification of stable vs. progressive mild cognitive impairment (MCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="adni.html">Alzheimer’s Disease diagnosis from T1-weighted MRI</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Live cell image compression and classification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="live-cell-image-compression-and-classification">
<h1>Live cell image compression and classification<a class="headerlink" href="#live-cell-image-compression-and-classification" title="Permalink to this heading">#</a></h1>
<p>This application of MEDL uses an autoencoder-classifier (AEC) to compress cell
images into a vector representation while also classifying their phenotype.</p>
<p>Images of cells from melanoma patient-derived xenografts (PDXs) were provided by
the Danuser lab. The dataset includes 7 PDXs, with 3 labeled as “high metastatic
efficiency” and 4 labeled as “low metastatic efficiency” based on experimental
observations. The classification task is to predict is whether each cell came
from a PDX with high or low metastatic efficiency. Cells were imaged across
several days, which creates a batch effect</p>
<section id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">create_dataset.py</span></code> selects images from 7 PDXs across several dates (batches)
for inclusion, then divides into training/validation/test sets. The remaining
dates are heldout as “unseen batches” to evaluate model generalization. The
images and associated labels are saved as compressed .npz files to be loaded
into memory when training models. (Unfortunately, disk read speed is too slow to
efficiently stream .png files from disk during training using an
ImageDataGenerator.)</p>
</section>
<section id="model-training">
<h2>Model training<a class="headerlink" href="#model-training" title="Permalink to this heading">#</a></h2>
<p>Call <code class="docutils literal notranslate"><span class="pre">main.py</span></code> to train a desired model type. Model types include:</p>
<ul class="simple">
<li><p>Conventional AEC: no explicit modeling of fixed or random effects</p></li>
<li><p>Domain adversarial AEC: uses domain adversarial learning to enforce learning
of batch-agnostic features, i.e. fixed effect features</p></li>
<li><p>Domain enhancing (random effects) AEC: emphasizes batch-specific features,
i.e. random effect features</p></li>
<li><p>Mixed effects AEC: Combines components of the domain adversarial and domain
enhancing models. (work in progress)</p></li>
</ul>
<p>See model details below.</p>
<p>For example, to train the conventional AEC::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">model_type</span> <span class="n">conventional</span> <span class="o">--</span><span class="n">output_dir</span> <span class="o">&lt;</span><span class="n">output</span> <span class="n">location</span><span class="o">&gt;</span>
   <span class="o">--</span><span class="n">training_metadata</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_train</span><span class="o">.</span><span class="n">csv</span>
   <span class="o">--</span><span class="n">training_data</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_train</span><span class="o">.</span><span class="n">npz</span>
   <span class="o">--</span><span class="n">val_metadata</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_val</span><span class="o">.</span><span class="n">csv</span>
   <span class="o">--</span><span class="n">val_data</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_val</span><span class="o">.</span><span class="n">npz</span>
</pre></div>
</div>
<p>If the data path arguments are not given, it will default to some preset
locations (see <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">main.py</span> <span class="pre">--help</span></code>). Note that all paths can be given
relative to the <code class="docutils literal notranslate"><span class="pre">RESULTSDIR</span></code> and <code class="docutils literal notranslate"><span class="pre">DATADIR</span></code> global variables set in the
<code class="docutils literal notranslate"><span class="pre">settings.py</span></code> file. They will automatically be expanded.</p>
<p>Next, to evaluate the trained model on test data::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">model_type</span> <span class="n">conventional</span> <span class="o">--</span><span class="n">output_dir</span> <span class="o">&lt;</span><span class="n">output</span> <span class="n">location</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">do_test</span>
   <span class="o">--</span><span class="n">test_metadata</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_test</span><span class="o">.</span><span class="n">csv</span> <span class="o">--</span><span class="n">test_data</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_test</span><span class="o">.</span><span class="n">npz</span>
   <span class="o">--</span><span class="n">load_weights_epoch</span> <span class="o">&lt;</span><span class="n">epoch</span> <span class="kn">from</span> <span class="nn">which</span> <span class="n">to</span> <span class="n">load</span> <span class="n">weights</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Similarly, to evaluate on data from heldout batches::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">model_type</span> <span class="n">conventional</span> <span class="o">--</span><span class="n">output_dir</span> <span class="o">&lt;</span><span class="n">output</span> <span class="n">location</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">do_test</span>
   <span class="o">--</span><span class="n">test_metadata</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_unseen</span><span class="o">.</span><span class="n">csv</span> <span class="o">--</span><span class="n">test_data</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_unseen</span><span class="o">.</span><span class="n">npz</span>
   <span class="o">--</span><span class="n">load_weights_epoch</span> <span class="o">&lt;</span><span class="n">epoch</span> <span class="kn">from</span> <span class="nn">which</span> <span class="n">to</span> <span class="n">load</span> <span class="n">weights</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="utilities">
<h2>Utilities<a class="headerlink" href="#utilities" title="Permalink to this heading">#</a></h2>
<p>To run inference on trained models and obtain latent representations,
reconstructions, or classifications, use <code class="docutils literal notranslate"><span class="pre">model_tools.py</span></code>. See <code class="docutils literal notranslate"><span class="pre">python</span>
<span class="pre">model_tools.py</span> <span class="pre">--help</span></code> for arguments.</p>
<p>For example, to compute classification predictions on a trained conventional AEC::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">model_tools</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">image_data</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_</span><span class="o">*.</span><span class="n">npz</span>
   <span class="o">--</span><span class="n">image_list</span> <span class="o">&lt;</span><span class="n">datadir</span><span class="o">&gt;/</span><span class="n">data_</span><span class="o">*.</span><span class="n">csv</span>
   <span class="o">--</span><span class="n">weights</span> <span class="o">&lt;</span><span class="n">weights</span> <span class="n">path</span><span class="o">.</span><span class="n">h5</span><span class="o">&gt;</span>
   <span class="o">--</span><span class="n">model_type</span> <span class="n">conventional</span>
   <span class="o">--</span><span class="n">classifications</span> <span class="o">&lt;</span><span class="n">outputpath</span><span class="o">.</span><span class="n">csv</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">--latents</span></code> or <code class="docutils literal notranslate"><span class="pre">--reconstructions</span></code> arguments to output latent
representations or reconstructions. Classifications are saved as .csv files,
latents as .pkl Pandas DataFrame files, and reconstructions as .npy files.</p>
</section>
<section id="inferring-the-cluster-membership-design-matrix-for-unseen-batches">
<h2>Inferring the cluster membership design matrix for unseen batches<a class="headerlink" href="#inferring-the-cluster-membership-design-matrix-for-unseen-batches" title="Permalink to this heading">#</a></h2>
<p>To fully utilize the random effects AEC on batches <em>not</em> seen during training,
we need to infer the design matrix Z for images from these unseen batches.
<code class="docutils literal notranslate"><span class="pre">infer_design_matrix.py</span></code> trains a convolutional classifier that predicts Z from
from each image, using training data from the seen batches. It then predicts Z
for the unseen batch data. Since the classifier uses a multi-class softmax
output, the resulting inferred Z will contain the probabilistic weighting of
similar seen sites for each unseen batch image.</p>
</section>
<section id="model-details">
<h2>Model details<a class="headerlink" href="#model-details" title="Permalink to this heading">#</a></h2>
<img alt="_images/me-aec.png" src="_images/me-aec.png" />
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}X&amp;: \text{2D image input}\\z&amp;: \text{design matrix containing one-hot encoded cluster membership of each sample}\\e_F(X; \beta)&amp;: \text{latent representation from fixed effects encoder}\\\hat{X}_F&amp;: \text{fixed effects-based reconstructed image}\\\hat{y}_F&amp;: \text{fixed effects-based classification prediction}\\\hat{y}_M&amp;: \text{mixed effects-based classification prediction}\\\beta&amp;: \text{fixed effects subnetwork weights}\\\newline
\text{Adversarial clasifier: }\\\hat{z}_A&amp;: \text{predicted cluster membership}\\\newline
\text{Random effects subnetwork:}\\U(z)&amp;: \text{cluster-specific weights, regularized to a zero-mean normal prior}\\e_R(X; U(z))&amp;: \text{latent representation from random effects encoder}\\\hat{X}_R&amp;: \text{random effects-based reconstructed image}\\\hat{z}_L&amp;: \text{predicted cluster membership from latents}\\\hat{z}_I&amp;: \text{predicted cluster membership from random effect-based reconstruction}\end{aligned}\end{align} \]</div>
</div>
<section id="conventional-aec">
<h3>Conventional AEC<a class="headerlink" href="#conventional-aec" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--model_type</span> <span class="pre">conventional</span></code></p>
<p>A classic convolutional neural network corresponding to the blue area in diagram
above.</p>
</section>
<section id="domain-adversarial-cnn">
<h3>Domain adversarial CNN<a class="headerlink" href="#domain-adversarial-cnn" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--model_type</span> <span class="pre">adversarial</span></code></p>
<p>Domain adversarial AEC which adds an adversarial classifier (gray area in
diagram). This adversary tries to predict the cluster membership of each sample
based on the layer outputs of the main CNN. At the same time, the main AEC tries
to increase the crossentropy of the adversary by learning features that are not
predictive of cluster membership.</p>
</section>
<section id="mixed-effects-aec">
<h3>Mixed effects AEC<a class="headerlink" href="#mixed-effects-aec" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--model_type</span> <span class="pre">mixedeffects</span></code></p>
<p>Mixed effects AEC which builds upon the domain adversarial AEC. A mirrored
random effects subnetwork (orange area in diagram) is added to learn
cluster-specific features. It takes the cluster membership $`z`$ as an input and
applies a cluster-specific scalar and cluster-specific bias to the output of
each convolutional block.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="license.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">License</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="adni.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Alzheimer’s Disease diagnosis from T1-weighted MRI</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Kevin P Nguyen, Alex Treacher, Albert Montillo
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Live cell image compression and classification</a><ul>
<li><a class="reference internal" href="#data-preparation">Data preparation</a></li>
<li><a class="reference internal" href="#model-training">Model training</a></li>
<li><a class="reference internal" href="#utilities">Utilities</a></li>
<li><a class="reference internal" href="#inferring-the-cluster-membership-design-matrix-for-unseen-batches">Inferring the cluster membership design matrix for unseen batches</a></li>
<li><a class="reference internal" href="#model-details">Model details</a><ul>
<li><a class="reference internal" href="#conventional-aec">Conventional AEC</a></li>
<li><a class="reference internal" href="#domain-adversarial-cnn">Domain adversarial CNN</a></li>
<li><a class="reference internal" href="#mixed-effects-aec">Mixed effects AEC</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script>window.MathJax = {"chtml": {"displayAlign": "left"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>
<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Live cell image compression and classification" href="melanoma.html" /><link rel="prev" title="Classification of stable vs. progressive mild cognitive impairment (MCI)" href="mci_conversion.html" />

    <!-- Generated with Sphinx 7.0.1 and Furo 2023.05.20 -->
        <title>Alzheimer’s Disease diagnosis from T1-weighted MRI - ARMED documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">ARMED  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">ARMED  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="_autosummary/armed.html">armed</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of armed</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/armed.callbacks.html">armed.callbacks</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of armed.callbacks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.callbacks.aec_callbacks.html">armed.callbacks.aec_callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.callbacks.segmentation.html">armed.callbacks.segmentation</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/armed.crossvalidation.html">armed.crossvalidation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of armed.crossvalidation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.crossvalidation.grouped_cv.html">armed.crossvalidation.grouped_cv</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.crossvalidation.splitting.html">armed.crossvalidation.splitting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/armed.metrics.html">armed.metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/armed.misc.html">armed.misc</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="_autosummary/armed.models.html">armed.models</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of armed.models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.autoencoder_classifier.html">armed.models.autoencoder_classifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.cnn_classifier.html">armed.models.cnn_classifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.lme.html">armed.models.lme</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.metalearning.html">armed.models.metalearning</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.mlp_classifiers.html">armed.models.mlp_classifiers</a></li>
<li class="toctree-l4"><a class="reference internal" href="_autosummary/armed.models.random_effects.html">armed.models.random_effects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/armed.settings.html">armed.settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/armed.tfutils.html">armed.tfutils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="applications.html">Applications</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Applications</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="synthetic_dataset.html">Synthetic datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="mci_conversion.html">Classification of stable vs. progressive mild cognitive impairment (MCI)</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Alzheimer’s Disease diagnosis from T1-weighted MRI</a></li>
<li class="toctree-l2"><a class="reference internal" href="melanoma.html">Live cell image compression and classification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="alzheimer-s-disease-diagnosis-from-t1-weighted-mri">
<h1>Alzheimer’s Disease diagnosis from T1-weighted MRI<a class="headerlink" href="#alzheimer-s-disease-diagnosis-from-t1-weighted-mri" title="Permalink to this heading">#</a></h1>
<p>In this application of ARMED, we classify individuals into Alzheimer’s Disease
or cognitively normal based on their structural MRI. Specifically, we acquire 2D
coronal slices through the right hippocampus and train a CNN classifier. Data is
sourced from the ADNI2 and ADNI3 datasets. Mixed effects modeling is
incorporated into the CNN to capture the differences between study sites,
including variations across scanner models, manufacturers, and acquisition
parameters.</p>
<section id="data-preprocessing">
<h2>Data preprocessing<a class="headerlink" href="#data-preprocessing" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Image selection: <code class="docutils literal notranslate"><span class="pre">select_images_dx.ipynb</span></code> performs some dataset curation and
selects good-quality images from the ADNI2 and ADNI3 datasets. It generates a
.csv file containing image information and an sMRI_input_files.csv file for
use with the DLLabPipeline.</p></li>
<li><p>Preprocessing pipeline: Run DLLabPipeline using the config_ADNI23_sMRI.ini
and the previously generated sMRI_input_files.csv.</p></li>
<li><p>Get cross-hippocampal coronal slices: <code class="docutils literal notranslate"><span class="pre">preproc_extract_hippo_slices.py</span></code>
extracts a coronal slice through the right hippocampus from each preprocessed
image. The slices are saved as .png files.</p></li>
<li><p>Partition data into train/validation/test/heldout sites:
<code class="docutils literal notranslate"><span class="pre">png_to_numpy_data_splits.py</span></code> selects a number of sites to include for
further analyses. Monte Carlo random splitting is used to generate
train/validation/test partitions and save as .npz Numpy files. Data from the
remaining, heldout sites is reserved for evaluating model generalization
performance to sites unseen during training.</p></li>
</ol>
</section>
<section id="models">
<h2>Models<a class="headerlink" href="#models" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">main.py</span></code> is the main script for training and evaluating models. It should be
run from the command line, passing in arguments for the selected model type and
data path. For example::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">model_type</span> <span class="n">mixedeffects</span> <span class="o">--</span><span class="n">data_dir</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">splits</span>
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">main.py</span> <span class="pre">--help</span></code> for arguments and the section below for model types.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">gradcam_comparison.ipynb</span></code> to generate GradCAM feature visualization figures.</p>
<p><code class="docutils literal notranslate"><span class="pre">infer_z_unseen_sites.py</span></code> trains a basic CNN to predict an image’s cluster
membership. This is used to infer the cluster membership design matrix Z for
each unseen site, allowing the ME-CNN to apply its learned random effects to
this data.</p>
</section>
<section id="model-details">
<h2>Model details<a class="headerlink" href="#model-details" title="Permalink to this heading">#</a></h2>
<img alt="_images/me-cnn.png" src="_images/me-cnn.png" />
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}X&amp;: \text{2D image input}\\z&amp;: \text{design matrix containing one-hot encoded cluster membership of each sample}\\\hat{y}_F&amp;: \text{fixed effects-based classification prediction}\\\hat{y}_M&amp;: \text{mixed effects-based classification prediction}\\\beta&amp;: \text{fixed effects subnetwork weights}\\h_F(X; \beta)&amp;: \text{latent output from penultimate dense layer}\\\newline
\text{Adversarial clasifier:}\\\hat{z}&amp;: \text{predicted cluster membership}\\\newline
\text{Random effects subnetwork:}\\U(z)&amp;: \text{cluster-specific weights, regularized to a zero-mean normal prior}\\h_R(X; U(z))&amp;: \text{random effects subnetwork output}\end{aligned}\end{align} \]</div>
</div>
<section id="conventional-cnn">
<h3>Conventional CNN<a class="headerlink" href="#conventional-cnn" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--model_type</span> <span class="pre">conventional</span></code></p>
<p>A classic convolutional neural network with 7 convolution blocks (convolution -&gt;
batch normalization -&gt; PReLU -&gt; max pooling) and two final dense layers. See
blue area in diagram above.</p>
</section>
<section id="cluster-input-cnn">
<h3>Cluster input CNN<a class="headerlink" href="#cluster-input-cnn" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--model_type</span> <span class="pre">clusterinput</span></code></p>
<p>A “naive” approach to incorporating cluster membership into the CNN, where $`Z`$
is concatenated into the model before the penultimate dense layer ($`h_F(X;
beta)`$ in diagram above).</p>
</section>
<section id="domain-adversarial-cnn">
<h3>Domain adversarial CNN<a class="headerlink" href="#domain-adversarial-cnn" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--model_type</span> <span class="pre">adversarial</span></code></p>
<p>Domain adversarial CNN which adds an adversarial classifier (gray area in
diagram). This adversary tries to predict the cluster membership of each sample
based on the layer outputs of the main CNN. At the same time, the main CNN tries
to increase the crossentropy of the adversary by learning features that are not
predictive of cluster membership. The result is a classifier that learns the
prediction task using features minimally associated with cluster effects.</p>
</section>
<section id="mixed-effects-cnn">
<h3>Mixed effects CNN<a class="headerlink" href="#mixed-effects-cnn" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--model_type</span> <span class="pre">mixedeffects</span></code></p>
<p>Mixed effects CNN which builds upon the domain adversarial CNN. A random effects
subnetwork (orange area in diagram) is added which takes the cluster membership
$`Z`$ as an input and applies a cluster-specific scalar to $`h_F(X; beta)`$ and
produces a cluster-specific bias. These are added to the fixed effects
subnetwork output before the final sigmoid activation.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="melanoma.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Live cell image compression and classification</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="mci_conversion.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Classification of stable vs. progressive mild cognitive impairment (MCI)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Kevin P Nguyen, Alex Treacher, Albert Montillo
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Alzheimer’s Disease diagnosis from T1-weighted MRI</a><ul>
<li><a class="reference internal" href="#data-preprocessing">Data preprocessing</a></li>
<li><a class="reference internal" href="#models">Models</a></li>
<li><a class="reference internal" href="#model-details">Model details</a><ul>
<li><a class="reference internal" href="#conventional-cnn">Conventional CNN</a></li>
<li><a class="reference internal" href="#cluster-input-cnn">Cluster input CNN</a></li>
<li><a class="reference internal" href="#domain-adversarial-cnn">Domain adversarial CNN</a></li>
<li><a class="reference internal" href="#mixed-effects-cnn">Mixed effects CNN</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script>window.MathJax = {"chtml": {"displayAlign": "left"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>